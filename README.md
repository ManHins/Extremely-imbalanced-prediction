# 机器学习转化概率预测系统

## 项目简介

这是一个基于机器学习的客户转化概率预测系统，专门用于分析客户外呼数据并预测客户的转化可能性。系统采用集成学习方法，结合多重欠采样策略处理不平衡数据，并提供SHAP可解释性分析。

## 主要功能

### 🎯 核心功能
- **数据预处理与特征工程**：智能处理外呼数据，创建多维度特征
- **不平衡数据处理**：采用多重欠采样策略优化模型性能
- **集成学习模型**：训练多个逻辑回归模型并集成预测
- **模型可解释性**：使用SHAP分析特征重要性
- **概率校准**：提供校准后的预测概率
- **批量预测**：支持大规模数据的转化概率预测

### 📊 特征工程
- **通话效率特征**：打通率、完播率、长通话率等
- **通话质量特征**：通话质量分、平均通话质量等
- **客户参与度特征**：参与度总分、转化模式得分等
- **时间和渠道特征**：呼叫时段、工作日、资源渠道等
- **衍生特征**：基于业务理解的组合特征

### 🔍 模型评估
- **多重验证策略**：交叉验证 + 独立测试集
- **多维度评估**：准确率、精确率、召回率、F1分数、AUC等
- **置信区间分析**：评估预测的可靠性
- **阈值优化**：提供多种业务策略的阈值选择

## 技术架构

### 模型设计
- **算法**：逻辑回归 (Logistic Regression)
- **集成方法**：多重欠采样 + 模型平均
- **正则化**：L2正则化防止过拟合
- **校准方法**：Platt Scaling概率校准

### 数据处理
- **不平衡处理**：欠采样策略（正负样本比例1:1）
- **特征标准化**：StandardScaler标准化
- **缺失值处理**：填充和特征工程
- **类别编码**：LabelEncoder处理分类变量

## 安装说明

### 环境要求
- Python 3.7+
- 推荐使用虚拟环境

### 安装依赖
```bash
pip install -r requirements.txt
```

## 使用指南

### 1. 模型训练
```python
# 加载数据
df = pd.read_parquet('your_data.parquet')

# 特征工程
X, y, feature_names, processed_data = create_features(df)

# 训练模型
training_results = train_logistic_regression_on_datasets(balanced_datasets, feature_names)

# 保存模型
model_directory, ensemble_model = save_ensemble_model_fixed(
    training_results, ensemble_results, feature_names, strategies
)
```

### 2. 模型预测
```python
import joblib

# 加载模型
model = joblib.load('path/to/ensemble_predictor.pkl')

# 预测概率
probabilities = model.predict_proba(X_new)

# 使用策略预测
predictions, probabilities = model.predict_with_strategy(X_new, '最高召回率策略')
```

### 3. 可用预测策略
- **最高召回率策略**：最大化转化用户识别率
- **最高F1策略**：平衡精确率和召回率
- **最高精确率策略**：最小化误判率
- **业务平衡策略**：适中的业务平衡点

## 项目结构

```
机器学习预测转化概率3shap.ipynb    # 主要代码文件
├── 数据预处理与特征工程           # 特征创建和数据处理
├── 多重欠采样策略               # 处理不平衡数据
├── 模型训练与优化               # 集成学习训练
├── 模型评估与验证               # 性能评估
├── SHAP特征重要性分析           # 模型可解释性
├── 模型保存与加载               # 模型部署
└── 批量预测应用                 # 实际应用示例
```

## 性能指标

### 模型性能
- **交叉验证准确率**：98%+
- **召回率**：99%+ (高召回率策略)
- **AUC**：99%+
- **F2分数**：99%+ (针对转化预测优化)

### 特征重要性 (Top 5)
1. **转化模式得分** - 综合转化行为模式评分
2. **高参与度** - 客户参与度指标
3. **高完播率** - 利益点完播行为
4. **工作日呼叫** - 呼叫时间特征
5. **呼叫周期** - 呼叫时间模式

## 数据要求

### 输入数据格式
需要包含以下字段的CSV/Excel/Parquet文件：
- `加密手机号码`：用户标识
- `是否转化成交`：目标变量（0/1）
- `拨打次数`、`打通次数`等：通话相关特征
- `资源渠道`：客户来源渠道
- `long_呼叫时段`、`long_是否工作日`等：时间特征
- `long_客户意向_AI`、`long_客户意向_人工`：意向评估

### 数据预处理
系统会自动进行：
- 缺失值填充
- 分类变量编码
- 特征标准化
- 衍生特征创建

## 输出说明

### 预测结果
- **转化概率**：0-1之间的概率值
- **概率百分比**：转换为百分比格式
- **预测类别**：基于阈值的二分类结果
- **置信度分析**：预测的可靠性评估

### 模型文件
- `ensemble_predictor.pkl`：集成预测器（主要使用）
- `model_1.pkl` ~ `model_N.pkl`：单个模型文件
- `model_metadata.pkl`：模型元数据和性能指标
- `使用指南.txt`：详细使用说明

## 注意事项

1. **数据质量**：确保输入数据格式正确，关键字段无缺失
2. **特征一致性**：预测时使用的特征必须与训练时一致
3. **阈值选择**：根据业务需求选择合适的预测策略
4. **模型更新**：建议定期重新训练模型以保持性能

## 技术特点

- ✅ **处理不平衡数据**：专门优化了极度不平衡的转化预测场景
- ✅ **集成学习**：多模型集成提高预测稳定性
- ✅ **可解释性**：SHAP分析提供特征重要性解释
- ✅ **概率校准**：提供校准后的可靠概率估计
- ✅ **多策略支持**：不同业务场景的阈值策略
- ✅ **工业级部署**：支持大规模数据批量预测

## 许可证

MIT License

## 贡献

欢迎提交Issue和Pull Request来改进项目。

## 联系方式

如有问题或建议，请通过GitHub Issues联系。 